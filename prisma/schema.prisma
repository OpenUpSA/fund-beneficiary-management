generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["relationJoins"]
  binaryTargets   = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_URL_NON_POOLING")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model User {
  id                          Int                          @id @default(autoincrement())
  name                        String
  email                       String                       @unique
  passwordHash                String
  approved                    Boolean                      @default(false)
  role                        Role                         @default(USER)
  createdAt                   DateTime                     @default(now())
  updatedAt                   DateTime                     @updatedAt
  localDevelopmentAgencies    LocalDevelopmentAgency[]
  localDevelopmentAgencyForms LocalDevelopmentAgencyForm[]
  documents                   Document[]
  Media                       Media[]
  passwordResetTokens         PasswordResetToken[]
}

model PasswordResetToken {
  id        Int                   @id @default(autoincrement())
  token     String                @unique
  userId    Int
  user      User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  type      PasswordResetType     @default(RESET)
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime              @default(now())
}

enum PasswordResetType {
  RESET
  SET_PASSWORD
}

model FundingStatus {
  id                       Int                      @id @default(autoincrement())
  label                    String                   @unique
  description              String
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime                 @updatedAt
  localDevelopmentAgencies LocalDevelopmentAgency[]
}

model Funder {
  id                   Int                @id @default(autoincrement())
  name                 String             @unique
  amount               Decimal            @db.Money
  about                String
  fundingStatus        FundStatus         @default(Active)
  fundingStart         DateTime           @default(now())
  fundingEnd           DateTime           @default(now())
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  focusAreas           FocusArea[]        @relation("FunderToFocusArea")
  organisationDetailId Int
  organisationDetail   OrganisationDetail @relation(fields: [organisationDetailId], references: [id])
  fundFunders          FundFunder[]
  documents            Document[]
  media                Media[]
}

model Location {
  id                       Int                      @id @default(autoincrement())
  label                    String                   @unique
  short                    String                   @unique
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime                 @updatedAt
  localDevelopmentAgencies LocalDevelopmentAgency[]
}

model FocusArea {
  id                       Int                      @id @default(autoincrement())
  label                    String                   @unique
  icon                     String
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime                 @updatedAt
  funds                    Fund[]                   @relation("FundToFocusArea")
  funders                  Funder[]                 @relation("FunderToFocusArea")
  localDevelopmentAgencies LocalDevelopmentAgency[] @relation("LocalDevelopmentAgencyToFocusArea")
}

model Fund {
  id                           Int                            @id @default(autoincrement())
  name                         String
  about                        String
  fundingStatus                FundStatus                     @default(Active)
  fundType                     FundType                       @default(CORE_FUND)
  fundingCalculationType       FundingCalculationType         @default(total_funded_amount)
  amount                       Decimal                        @db.Money
  defaultAmount                Decimal?                       @db.Money
  fundingStart                 DateTime                       @default(now())
  fundingEnd                   DateTime                       @default(now())
  createdAt                    DateTime                       @default(now())
  updatedAt                    DateTime                       @updatedAt
  focusAreas                   FocusArea[]                    @relation("FundToFocusArea")
  organisationDetailId         Int
  organisationDetail           OrganisationDetail             @relation(fields: [organisationDetailId], references: [id])
  fundFunders                  FundFunder[]
  fundLocalDevelopmentAgencies FundLocalDevelopmentAgency[]
  documents                    Document[]
  media                        Media[]
}

model FundFunder {
  id           Int      @id @default(autoincrement())
  fundId       Int
  funderId     Int
  amount       Decimal  @db.Money
  fundingStart DateTime @default(now())
  fundingEnd   DateTime @default(now())
  notes        String   @default("")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  fund         Fund     @relation(fields: [fundId], references: [id])
  funder       Funder   @relation(fields: [funderId], references: [id])

  @@unique([fundId, funderId])
}

model FundLocalDevelopmentAgency {
  id                       Int                    @id @default(autoincrement())
  fundId                   Int
  localDevelopmentAgencyId Int
  description              String                 @default("")
  fundingStart             DateTime               @default(now())
  fundingEnd               DateTime               @default(now())
  fundingStatus            FundLDAStatus          @default(Active)
  amountType               FundAmountType         @default(USE_DEFAULT)
  amount                   Decimal?               @db.Money
  createdAt                DateTime               @default(now())
  updatedAt                DateTime               @updatedAt
  fund                     Fund                   @relation(fields: [fundId], references: [id])
  localDevelopmentAgency   LocalDevelopmentAgency @relation(fields: [localDevelopmentAgencyId], references: [id])

  @@unique([fundId, localDevelopmentAgencyId])
}

model DevelopmentStage {
  id                       Int                      @id @default(autoincrement())
  label                    String                   @unique
  description              String
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime                 @updatedAt
  localDevelopmentAgencies LocalDevelopmentAgency[]
}

model LocalDevelopmentAgency {
  id                         Int                          @id @default(autoincrement())
  name                       String                       @unique
  about                      String                       @default("")
  totalFundingRounds         Int                          @default(0)
  amount                     Decimal?                     @db.Money
  fundingStart               DateTime                     @default(now())
  fundingEnd                 DateTime                     @default(now())
  developmentStageId         Int?
  fundingStatusId            Int?
  locationId                 Int?
  programmeOfficerId         Int?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @updatedAt
  organisationDetailId       Int
  developmentStage           DevelopmentStage?            @relation(fields: [developmentStageId], references: [id])
  fundingStatus              FundingStatus?               @relation(fields: [fundingStatusId], references: [id])
  location                   Location?                    @relation(fields: [locationId], references: [id])
  organisationDetail         OrganisationDetail           @relation(fields: [organisationDetailId], references: [id])
  programmeOfficer           User?                        @relation(fields: [programmeOfficerId], references: [id])
  LocalDevelopmentAgencyForm LocalDevelopmentAgencyForm[]
  focusAreas                 FocusArea[]                  @relation("LocalDevelopmentAgencyToFocusArea")
  contacts                   Contact[]                    @relation("ContactToLDA")
  media                      Media[]
  documents                  Document[]
  registrationStatus         RegistrationStatus           @default(not_registered)
  registrationCode           String                       @default("")
  registrationDate           DateTime?
  organisationStatus         OrganisationStatus           @default(active)
  operations                 OrganisationOperations?
  staffMembers               StaffMember[]
  userAccess                 UserAccess[]
  fundLocalDevelopmentAgencies FundLocalDevelopmentAgency[]
}

model FormStatus {
  id                          Int                          @id @default(autoincrement())
  label                       String
  icon                        String
  createdAt                   DateTime                     @default(now())
  updatedAt                   DateTime                     @updatedAt
  localDevelopmentAgencyForms LocalDevelopmentAgencyForm[]
}

model FormTemplate {
  id                          Int                          @id @default(autoincrement())
  name                        String                       @unique
  description                 String
  form                        Json                         @default("{}")
  active                      Boolean                      @default(true)
  templateType                FormTemplateType             @default(APPLICATION)
  linkedFormTemplateId        Int?
  linkedFormTemplate          FormTemplate?                @relation("LinkedFormTemplate", fields: [linkedFormTemplateId], references: [id])
  linkedFromTemplates         FormTemplate[]               @relation("LinkedFormTemplate")
  includeAdminFeedback        Boolean                      @default(false)
  sidebarConfig               Json                         @default("{\"amount\": true, \"status\": true, \"startDate\": true, \"endDate\": true, \"dueDate\": true}")
  createdAt                   DateTime                     @default(now())
  updatedAt                   DateTime                     @updatedAt
  localDevelopmentAgencyForms LocalDevelopmentAgencyForm[]
}

model LocalDevelopmentAgencyForm {
  id                       Int                          @id @default(autoincrement())
  localDevelopmentAgencyId Int
  formStatusId             Int
  formTemplateId           Int
  formData                 Json
  title                    String
  createdById              Int?
  amount                   Decimal                      @default(0) @db.Money
  dueDate                  DateTime                     @default(now())
  fundingStart             DateTime                     @default(now())
  fundingEnd               DateTime                     @default(now())
  submitted                DateTime?
  approved                 DateTime?
  linkedFormId             Int?
  linkedForm               LocalDevelopmentAgencyForm?  @relation("LinkedForm", fields: [linkedFormId], references: [id])
  linkedForms              LocalDevelopmentAgencyForm[] @relation("LinkedForm")
  adminFeedback            String?
  createdAt                DateTime                     @default(now())
  updatedAt                DateTime                     @updatedAt
  formStatus               FormStatus                   @relation(fields: [formStatusId], references: [id])
  formTemplate             FormTemplate                 @relation(fields: [formTemplateId], references: [id])
  localDevelopmentAgency   LocalDevelopmentAgency       @relation(fields: [localDevelopmentAgencyId], references: [id])
  createdBy                User?                        @relation(fields: [createdById], references: [id])
  documents                Document[]
  media                    Media[]
}

model OrganisationDetail {
  id                        Int                      @id @default(autoincrement())
  createdAt                 DateTime                 @default(now())
  updatedAt                 DateTime                 @updatedAt
  contactNumber             String                   @default("")
  email                     String                   @default("")
  website                   String                   @default("")
  physicalStreet            String                   @default("")
  physicalComplexName       String                   @default("")
  physicalComplexNumber     String                   @default("")
  physicalCity              String                   @default("")
  physicalPostalCode        String                   @default("")
  physicalProvince          String                   @default("")
  physicalDistrict          String                   @default("")
  postalStreet              String                   @default("")
  postalComplexName         String                   @default("")
  postalComplexNumber       String                   @default("")
  postalCity                String                   @default("")
  postalProvince            String                   @default("")
  postalDistrict            String                   @default("")
  postalCode                String                   @default("")
  useDifferentPostalAddress Boolean                  @default(false)
  latitude                  Float?
  longitude                 Float?
  mapAddress                String                   @default("")
  LocalDevelopmentAgencies  LocalDevelopmentAgency[]
  Funds                     Fund[]
  Funders                   Funder[]
}

model OrganisationOperations {
  id                            Int                    @id @default(autoincrement())
  localDevelopmentAgencyId      Int                    @unique
  vision                        String                 @default("")
  mission                       String                 @default("")
  objectives                    String                 @default("")
  programmaticAreas             String                 @default("")
  climateFocus                  String                 @default("")
  youthFocus                    String                 @default("")
  genderFocus                   String                 @default("")
  fundraisingStrategies         String                 @default("")
  ensureOrgNotReliantOnScatOnly String                 @default("")
  partnershipsWithinOutside     String                 @default("")
  nationalAdvocacyStrategies    String                 @default("")
  monitoringAndLearning         String                 @default("")
  createdAt                     DateTime               @default(now())
  updatedAt                     DateTime               @updatedAt
  localDevelopmentAgency        LocalDevelopmentAgency @relation(fields: [localDevelopmentAgencyId], references: [id])
}

model StaffMember {
  id          Int     @id @default(autoincrement())
  firstName   String
  lastName    String
  gender      Gender
  position    String?
  isCommittee Boolean @default(false)

  localDevelopmentAgencyId Int
  localDevelopmentAgency   LocalDevelopmentAgency @relation(fields: [localDevelopmentAgencyId], references: [id])
}

model UserAccess {
  id          Int         @id @default(autoincrement())
  fullName    String
  email       String
  accessLevel AccessLevel @default(ReadOnly)

  localDevelopmentAgencyId Int
  localDevelopmentAgency   LocalDevelopmentAgency @relation(fields: [localDevelopmentAgencyId], references: [id])
}

model Contact {
  id                       Int                      @id @default(autoincrement())
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime                 @updatedAt
  name                     String
  contactNumber            String                   @default("")
  email                    String                   @default("")
  position                 String                   @default("")
  info                     String                   @default("")
  localDevelopmentAgencyId Int
  localDevelopmentAgency   LocalDevelopmentAgency   @relation("ContactToLDA", fields: [localDevelopmentAgencyId], references: [id])
}

model MediaSourceType {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  title     String
  Media     Media[]
}

model Media {
  id                            Int                         @id @default(autoincrement())
  createdAt                     DateTime                    @default(now())
  updatedAt                     DateTime                    @updatedAt
  title                         String
  description                   String
  filePath                      String
  mediaType                     MediaType                   @default(PHOTOGRAPH)
  localDevelopmentAgencyId      Int?
  localDevelopmentAgency        LocalDevelopmentAgency?     @relation(fields: [localDevelopmentAgencyId], references: [id])
  localDevelopmentAgencyFormId  Int?
  localDevelopmentAgencyForm    LocalDevelopmentAgencyForm? @relation(fields: [localDevelopmentAgencyFormId], references: [id])
  fundId                        Int?
  fund                          Fund?                       @relation(fields: [fundId], references: [id])
  funderId                      Int?
  funder                        Funder?                     @relation(fields: [funderId], references: [id])
  mediaSourceTypeId             Int?
  mediaSourceType               MediaSourceType?            @relation(fields: [mediaSourceTypeId], references: [id])
  createdById                   Int?
  createdBy                     User?                       @relation(fields: [createdById], references: [id])
}

model Document {
  id                            Int                         @id @default(autoincrement())
  createdAt                     DateTime                    @default(now())
  updatedAt                     DateTime                    @updatedAt
  title                         String
  description                   String
  filePath                      String
  documentType                  DocumentType                @default(DOC)
  validFromDate                 DateTime?
  validUntilDate                DateTime?
  localDevelopmentAgencyId      Int?
  localDevelopmentAgency        LocalDevelopmentAgency?     @relation(fields: [localDevelopmentAgencyId], references: [id])
  localDevelopmentAgencyFormId  Int?
  localDevelopmentAgencyForm    LocalDevelopmentAgencyForm? @relation(fields: [localDevelopmentAgencyFormId], references: [id])
  fundId                        Int?
  fund                          Fund?                       @relation(fields: [fundId], references: [id])
  funderId                      Int?
  funder                        Funder?                     @relation(fields: [funderId], references: [id])
  uploadedBy                    DocumentUploadType          @default(SCAT)
  createdById                   Int?
  createdBy                     User?                       @relation(fields: [createdById], references: [id])
}

model Province {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  code      String   @unique
  districts Json // Stored as JSON array of district objects
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  USER
  PROGRAMME_OFFICER
  ADMIN
  SUPER_USER
}

enum MediaType {
  PHOTOGRAPH
  GRAPHIC
}

enum DocumentType {
  DOC
  SPREADSHEET
}

enum DocumentUploadType {
  Funder
  Fund
  SCAT
  LDA
}

enum RegistrationStatus {
  not_registered @map("Not registered")
  registered_npo @map("Registered NPO")
  registered_bpo @map("Registered BPO")
}

enum OrganisationStatus {
  active   @map("Active")
  inactive @map("Inactive")
  archived @map("Archived")
}

enum Gender {
  Male
  Female
  Other
}

enum AccessLevel {
  Admin
  ReadOnly
}

enum FundType {
  CORE_FUND
  PROJECT_FUND
}

enum FundLDAStatus {
  Paused
  Active
  Cancelled
}

enum FundStatus {
  Paused
  Active
  Cancelled
}

enum FundingCalculationType {
  total_funded_amount
  lda_funding_per_month
}

enum FundAmountType {
  USE_DEFAULT
  AD_HOC
}

enum FormTemplateType {
  APPLICATION
  REPORT
}